\documentclass[a4paper]{article}
\usepackage{url}
\usepackage[margin=2cm]{geometry}
\usepackage{amsmath}
\usepackage{fancyhdr}

\renewcommand{\headrulewidth}{0pt}


\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\thepage}

\makeatletter
\renewcommand\maketitle
  {\noindent
   {\Large\bfseries\@title}%
   \medskip\par\noindent
   {\large\bfseries\@author}%
   \hfill
   {\large\@date}%
   \bigskip\par\noindent
  }
\makeatother

\title{The Governing Equations of the Red Cell Model (RCM)}
\author{Virgilio L. Lew}
\date{September 2024}

% \newcommand{\med}[1]{[#1]^m}
\newcommand{\med}[1]{M#1}
% \newcommand{\cell}[1]{[#1]^c}
\newcommand{\cell}[1]{C#1}


\newcommand{\MA}{\med{A}}
\newcommand{\MB}{\med{B}}
\newcommand{\MBH}{\med{BH}}
\newcommand{\MGluca}{M_{glucamine}}
\newcommand{\MNa}{\med{Na}}
\newcommand{\MK}{\med{K}}
\newcommand{\MCatp}{\med{Ca^{2+}}}
\newcommand{\MMgtp}{\med{Mg^{2+}}}
\newcommand{\MGluco}{M_{gluconate}}
\newcommand{\MH}{\med{H}}
\newcommand{\MOs}{\med{Os}}
\newcommand{\MCat}{\med{Cat}}
\newcommand{\MMgt}{\med{Mgt}}
\newcommand{\MCa}{\med{Ca}}
\newcommand{\MMg}{\med{Mg}}
\newcommand{\MSuc}{M_{sucrose}}


\newcommand{\KB}{K_B}
\newcommand{\KBCa}{K_{{BC}_a}}
\newcommand{\KCa}{K_{Ca}}

\newcommand{\Km}[1]{Km_{#1}}
\newcommand{\KI}[1]{KI_{#1}}

\newcommand{\CNa}{\cell{Na}}
\newcommand{\CK}{\cell{K}}
\newcommand{\CH}{\cell{H}}
\newcommand{\CMgtp}{\cell{Mg^{2+}}}
\newcommand{\CCatp}{\cell{Ca^{2+}}}
\newcommand{\CA}{\cell{A}}
\newcommand{\nHb}{n_{Hb}}
\newcommand{\CHb}{\cell{Hb}}
\newcommand{\nX}{n_{X}}
\newcommand{\CXm}{\cell{X^{-}}}
\newcommand{\COs}{\cell{Os}}
\newcommand{\CCa}{\cell{Ca}}
\newcommand{\CCaB}{\cell{CaB}}
\newcommand{\CBCa}{\cell{B_{Ca}}}
\newcommand{\CMgB}{\cell{MgB}}
\newcommand{\CMg}{\cell{Mg}}
\newcommand{\CX}{\cell{X}}

\newcommand{\QX}{QX}
\newcommand{\QCa}{QCa}
\newcommand{\QXm}{QX^{-}}

\newcommand{\pH}[1]{pH_{#1}}
\newcommand{\pI}{pI}

\newcommand{\fHb}{f_{Hb}}


\newcommand{\F}[2]{F_{#1}#2}

\newcommand{\kk}[2]{k_{#1}#2}

\begin{document}

\setcounter{page}{28}

\maketitle

\section{Introduction}\label{introduction}

% This document is designed to accompany publications [1] and [2].

% Red blood cell homeostasis addresses the subset of mechanisms that
% control the dynamic changes in cell volume, membrane potential, ionic
% composition, membrane transport and osmotic gradients in response to
% perturbations. The system modelled under RCM consists of a suspension of identical
% RBCs whose dynamic behaviour is constrained only by charge and mass
% conservation. The equations implement these laws following a strict
% computational sequence representative of the multiple interconnected
% processes involved, delivering true and tested predictions on the
% homeostatic behaviour of human RBCs in physiological, pathological and
% experimental conditions.

% We retain in the equations the names of parameters and variables as used for model inputs and outputs where the use of conventional nomenclatures for concentrations (i.e. $[Ca^{2+}]_c$, $[Mg^{2+}]_o$) or of Greek symbols for fluxes was not feasible.  Coherence with model operation in the choice of equation nomenclature was considered more important than compliance with established nomenclature, clarity of meaning being preserved in the unconventional style and fully explained in the Appendix glossaries of the User Guide (\url{https://github.com/sdrogers/redcellmodeljava}).

Red blood cell homeostasis addresses the subset of mechanisms that control the dynamic changes in cell volume, membrane potential, ionic composition, membrane transport and osmotic gradients in response to perturbations. The modelled system consists of a suspension of identical RBCs whose dynamic behaviour is constrained only by charge and mass conservation. The equations implement these laws following a strict computational sequence representative of the multiple interconnected processes involved. The default values set for all the model parameters have been experimentally determined, allowing model outputs to predict the homeostatic behaviour of human RBCs in physiological, pathological and experimental conditions within accuracy margins of about 5-10\%.  

The current text of the Governing Equations of the RCM is an updated version of the original published in 2021 [1, 2]. The complete model code, together with a User Guide and a detailed tutorial, are available 
 with open access in the repository (https://github.com/sdrogers/redcellmodeljava).   


\subsection{The initial Reference State (RS)}

The RBC reference state describes the initial condition of the system in
a pump-leak balanced steady state. For compliance with initial
electroneutrality and osmotic equilibrium we use a phenomenology in
which the charge, $\nX$, and cell content of the global, non-haemoglobin,
impermeant cell anion, $\QXm$ , are treated as wildcard parameters in
equations 3 and 8. The $\nX$ and $\CXm$ values emerging from such treatment
correspond closely with the known organic and inorganic phosphate pools
of metabolically normal RBCs {[}3{]}. When modifying the initial default
values in the RS the wildcard parameters may change. The model
automatically recalculates their value potentially changing slightly the
constitutive make up of the impermeant cell anion ($\nX  \QXm$) in
the new cell.

\subsubsection{Medium electroneutrality}\label{medium-electroneutrality}

\begin{equation}
\MA + (\MB - \MBH) + \MGluco-(\MNa + \MK + 2(\MCatp + \MMgtp) + \MGluca) = 0 \tag{1}
\end{equation}

Medium concentration of proton-bound buffer, $\MBH$ (HEPES, by default):

\setcounter{equation}{1}

\begin{equation}
\MBH = \MB\left(\frac{\MH}{\KB + \MH}\right)
\end{equation}

\subsubsection{Intracellular electroneutrality}

\begin{equation}
\CNa + \CK + \CH + 2\CMgtp + 2\CCatp - (\CA + \nHb\CHb + \nX\CXm) = 0
\end{equation}

$\nHb$, the net charge on the haemoglobin molecule, is represented by the Cass-Dalmark equation [4],

\begin{equation}
\nHb=  a(\pH{i} - \pI)
\end{equation}

where $a$ corresponds to the linear segment of the proton titration curve of Hb in intact RBCs, and $\pI$ is the $\pH{i}$ at the isoelectric point of haemoglobin.

In the Reference steady state the net fluxes of each of the i-transported solutes is zero, and pump-leak balance is represented by $\sum I_j = F\sum z_jF_j = 0$, where $I_j$ is the current carried by transporter $j$, $F$ is the Faraday constant, $z_j$ is the net charge on each of the j-transporters, and $F_j$ is the net flux through the j-transporter; $z \neq 0$ only for electrogenic transporters. 

\subsubsection{Medium and cell osmolarities, MOs and COs:}

\begin{eqnarray}
	\MOs &=& \MA + \MB + \MGluco + \MNa + \MK + \MCat + \MMgt + \MGluca\\
	\COs &=& \CNa + \CK + \CA + \CH + \CMgtp + \CCatp  + \fHb\CHb + \CXm
\end{eqnarray}

$\fHb$ is the osmotic coefficient of haemoglobin, represented with only two virial coefficients, $b$ and $c$:

\begin{equation}
\fHb = 1 + b\times\CHb + c\times\CHb^2 
\end{equation}

\subsubsection{Osmotic equilibrium in the reference steady state:}

\begin{equation}
\MOs = \COs
\end{equation}

\subsubsection{Cytoplasmic buffering of protons, calcium and magnesium.}
Heamoglobin is the major cytoplasmic buffer for protons (eq 4) and for calcium ($\alpha$-buffer in eq 9c).  The main magnesium buffers are ATP and 2,3-DPG, compounds integrated within the X  phenomenology.  Because the bound forms of Ca and Mg are contained within $CX^-$ , they are not included as separate osmolarity contributors in eq 6, leaving only the free forms of $Ca^{2+}$ and $Mg^{2+}$ as osmotic contributors.  

Cytoplamic $Ca^{2+}$ and $Mg^{2+}$ buffering have been measured with precision in intact RBCs [5-8] enabling accurate representations in the model.  The total Ca and Mg content of the cells, QCa and QMg, is reported in units of mmol/(340g Hb) (or mmol/Loc) whereas concentrations of the free forms, $\CCatp$ and $\CMgtp$, are expressed in units of mmol/Lcw, a conversion requiring translation for operational reasons in the model. Equation 9a translates QCa in units of mmol/Loc to CCa in units of mmol/Lcw using:


\setcounter{equation}{0}
\renewcommand{\theequation}{9.\alph{equation}}

\begin{equation}
\CCa = \QCa\left(\frac{RCV}{Vw}\right)
\end{equation}
 

The total calcium concentration is the sum of free and bound forms:

\begin{equation}
\CCa = \CCatp + \CCaB
\end{equation}

There are two buffer systems for binding calcium in the RBC cytoplasm, $\alpha$ (mostly haemoglobin), and the BCa/KBCa buffer [6]. The concentration of bound calcium, CCaB, at each total calcium concentration, CCa, is represented by:

\begin{equation}
\CCaB = \alpha\CCa + \CBCa\left(\frac{\CCatp}{\CCatp + \KBCa}\right)
\end{equation}

$CCa^{2+}$ is solved from the implicit equation: 

\begin{equation}
\CCa – \CCatp – \CCaB = 0  
\end{equation}

by the Newton-Raphson routine in the RS and at the end of the computations in each iteration cycle.  The measured values of the calcium binding parameters are $\alpha = 0.30$, $\CBCa = 0.026$ mmol/Loc, and $\KBCa = 0.014$ mM [6].

The corresponding equations for cytoplasmic magnesium buffering and $CMg^{2+}$ are:

\begin{eqnarray}
\CMg &=& \left(\frac{RCV}{Vw}\right)\\
\CMg &=& \CMgtp + \CMgB\\
\CMgB &=& CB_{Mg}1\left(\frac{\CMgtp}{\CMgtp+KB_{Mg}1}\right)+CB_{Mg}2\left(\frac{\CMgtp}{\CMgtp+KB_{Mg}2}\right)+CB_{Mg}3
\end{eqnarray}

$\CMgtp$ is solved from the implicit equation: 

\begin{equation}
\CMg - \CMgtp - \CMgB = 0
\end{equation}


The measured values of the Mg bufferes [8] are: $CB_{Mg}1$ = 1.2 mmol/Loc, $KB_{Mg}1 = 0.08$ mM; $CB_{Mg}2 = 7.5$ mmol/Loc (15 mEq/Loc), $KB_{Mg}2 = 3.6$ mM; $CB_{Mg}3 = 0.05$ mmol/Loc. $B_{Mg}1$ represents ATP, $BMg2$ represents 2,3-DPG and miscellaneous phosphate groups, and $BMg3$ is an unidentified high affinity magnesium buffer.  



\subsubsection{Effects of deoxygenation on cytoplasmic $Mg^{2+}$ buffering and pHi.}
Deoxygenation increases haemoglobin binding of ATP and 2,3-DPG thus reducing their availability for buffering intracellular magnesium.  $CB_{Mg}1$ is reduced by half and $CB_{Mg}2$ by 1.7 [8].  This is particularly relevant for simulating accurately the effects of changing the oxygenation condition of RBCs, a process in which changes in $CMg^{2+}$ become enmeshed with effects arising from changes in the isoelectric point of haemoglobin, pI (eq 4).
% In vivo, RBCs are continuously changing between oxy and deoxy states as they flow between the arterial and venous vasculature causing well documented alternating changes in pHi, $CMg^{2+}$, CA and cell volume which the model accurately reproduces.  Although these changes are fully reversible in physiological conditions, deoxygenation of sickle RBCs can lead to hyperdense collapse, as shown in the next paper [2]. 

\subsubsection{Charge balance during $Mg^{2+}$ buffering changes.}

By treating the Mg buffers as part of the global impermeant cell ion the osmotic balance on deoxygenation remains
undisturbed. On the other hand, the change in $Mg^{2+}$ charge, $QMg^{2+}$, needs balancing from within the global charge
on $X$, $nXQX$ by a corresponding change in $nX$. Because $X$ and $Mg$ are treated as impermeant cytoplasmic solutes
in the model, their amounts per litre original cells, $QX$ and $QMg$, are set in the Reference State as constants in the
system, their concentrations varying only with changes in cell volume. Therefore, from $\Delta nX = nX_{deoxy} - nX_{oxy}$
and from $QX^{-}_{deoxy} - QX^{-1}_{oxy} = 2(QMg^{2+}_{deoxy} - QMg^{2+}_{oxy})$ we derive $nX_{deoxy} = nX_{oxy} - 2(QMg^{2+}_{deoxy} - QMg^{2+}_{oxy})/QX$.
Thus, both $nX_{oxy}$ and $nX_{deoxy}$ become defined as constants whose values are set by the values of $QMg^{2+}$ and of the
wildcard parameters $nX$ and $QX^{-}$ as derived from equations 3 and 8 in the Reference State. With the current default
settings in the Reference State, $nX_{oxy} =-0.4352$, and $nX_{deoxy} =-0.4511$, values instantly changed and reversed during
deoxygenation-reoxygenation cycles.

\subsubsection{Effects of change in the isoelectric point of haemoglobin on cell pH, pHi}
Hb is assumed to be in a oxy-state by default, the most frequent experimental condition. Deoxygenation of Hb (Deoxy) changes its pI(0oC) from 7.2 to 7.5.  The model automatically adjusts the actual pI change for the temperature of the experiment.  The pI shifts during oxy-deoxy transitions cause sudden changes in the protonization condition of Hb with secondary changes in pHi and $CMg^{2+}$, changes which the model predicts with verified accuracy [9-11].  Electroneutrality preservation during oxy-deoxy transitions requires constancy of nHb values (eq 4) when pI changes, from which the compensatory changes in pHi can be derived according to [10]: 

On deoxygenation:

\setcounter{equation}{0}
\renewcommand{\theequation}{4.\alph{equation}}
\begin{equation}
pHi_{deoxy} = pHi_{oxy} + pI_{deoxy} - pI_{oxy} 
\end{equation}
On reoxygenation:
\begin{equation}
pHioxy = pHi_{deoxy} + pI_{oxy} - pI_{deoxy} 
\end{equation}

\subsection{The dynamic state (DS)}

\setcounter{equation}{9}
\renewcommand{\theequation}{\arabic{equation}}

A first requirement at the start of simulations is to define the relative volume occupied by cells in the cell suspension system, the cell volume fraction, CVF.  Perturbations alter the flux of transported solutes and water across the plasma membrane of the cell thus initiating a cascade of downstream changes in the compositions of cell and suspending medium.  It is therefore important to start by listing the membrane transport component of the cell and of the equations describing their basic kinetic properties.  

\subsubsection{Flux equations of the model, $F_i$ and $F_j$}
All flux equations are defined as products between permeabilities (P) or rate constants (k) and driving forces. The substrates of the RBC membrane transporters are Na, K, A, H, Ca, Mg and water, the "i" in $F_i$.  The sign-convention applied in the equations is for positive fluxes into the cell (influx) and for negative fluxes into the medium (efflux). The name convention adopted here for the transport of substrate X by the different membrane transporters is as follows: FPX = pump-mediated flux of X, with P = NaP for the Na/K pump or CaP for the calcium pump (PMCA); FGX = X-flux through electrodiffusional channel defined with constant field kinetics; FXA = electroneutral carrier-mediated cotransport of cation X and anion A defined with low-saturation kinetics; FzX = electrodiffusional flux of X through PIEZO1 channel; FCoX = electroneutral cotransport of X mediated by the Na:K:2Cl symport, of minimal expression and activity in human RBCs; FA23X = electroneutral $M^{2+}:2H^+$ exchange flux through the divalent cation ionophore A23187, the only exogenous membrane transporter included in the model; Fw = water flux mediated mainly by aquaporins and partly by partition diffusion through the plasma membrane.  

\setcounter{equation}{0}
\renewcommand{\theequation}{10.\alph{equation}}

\subsubsection{Flux pathways for each transported substrate, $F_i$:}
\begin{eqnarray}
\F{}{Na} &=& \F{NaP}{Na} + \F{G}{Na} + \F{Na}{A} + \F{Co}{Na} + \F{z}{Na}\\
\F{K} &=& \F{NaP}{K} + \F{G}{K} + \F{K}{A} + \F{KGardos} + \F{Co}{K} + \F{z}{K}\\
\F{}{A} &=& \F{G}{A} + \F{H}{A} + \F{Na}{A} + \F{K}{A} + \F{z}{A} + 2\times\F{Co}{A}\\
\F{}{H} &=& \F{G}{H} + \F{H}{A} + \F{Ca}{PH} + \F{A23}{H} \\
\F{}{Ca} &=& \F{CaP}{Ca} + \F{G}{Ca} + \F{z}{Ca} + \F{A23}{Ca} \\
\F{}{Mg} &=& \F{G}{Mg} + \F{A23}{Mg} \\
\F{}{w}  &=& Pw\times (\COs – \MOs)
\end{eqnarray}

There are no data on PIEZO1-mediated $Mg^{2+}$ fluxes in RBCs.  Although PzMg most certainly has a small finite value, $\F{z}{Mg}$ is likely to be very small under the usually low electrochemical $Mg^{2+}$ gradients across the RBC membrane.  With this level of uncertainty, $\F{z}{Mg}$ was not included in the current model version.  

\subsubsection{Kinetic descriptions of individual transporters}
Certain transporter kinetics are reported in the equations with the default numerical values used for dissociation and rate constants in the model, based on well established values in the literature and on the good semi-quantitative fits to experimental data provided in the past [12-14].
% The default values of all permeabilities and rate-constants used in the model (P or k) correspond to experimentally measured values at 37oC, $P = P(37)$ or $k = k(37)$.  Temperature-changed values of P or k, $P = P(T)$ or $k(T)$, are computed relative to $P(37)$ or $k(37)$ using the Q10-derived formalism for temperature coefficients. In eq (11) we use P to represent both P- or k-defined values:

% \setcounter{equation}{10}
% \renewcommand{\theequation}{\arabic{equation}}
% \begin{equation}
% P(T)  =  \frac{P(37)}{10^{\left(\frac{37-T}{10}\right)\log(Q10)}}
% \end{equation}
\setcounter{equation}{0}
\renewcommand{\theequation}{11.\alph{equation}}


\subsubsection{Na/K pump mediated fluxes of Na and K (f = forward; r = reverse) [15, 16]}

We redefine the forward sodium flux through the sodium pump to introduce its $CMg^{2+}$-dependence as found by Flatman[35]:

\begin{equation}
  \F{NaP}{Na}^f  = -\F{NaP}{max}^f \left(\frac{\CMg^{2+}}{0.04 + CMg^{2+}}\right)\left(\frac{\CNa}{\CNa + 0.2(1 + \CK/8.3)}\right)^3 \left(\frac{\MK}{\MK + 0.1(1 + \MNa/18)}\right)^2 \\
\end{equation}

$\F{NaP}{max}^f$ should now be derived in the RS from the values set for $\F{NaP}{Naf}$, $CMg^{2+}$, $CNa$ and $MK$ using eq 11a, as part of the steady-state equations (1-8).


\begin{eqnarray}
% \F{NaP}{Na}^f  &=& -\F{NaP}{max}^f\left(\frac{\CNa}{\CNa + 0.2(1 + \CK/8.3)}\right)^3 \left(\frac{\MK}{\MK + 0.1(1 + \MNa/18)}\right)^2 \\
\F{NaP}{Na}^r  &=& \F{NaP}{max}^r\left(\frac{\CK}{\CK + 8.3(1 + \CNa/0.2)}\right)^2\left(\frac{\MNa}{\MNa + 18(1 + \MK/0.1)}\right)^3 \\
\F{NaP}{Na} &=& \F{NaP}{Naf} + \F{NaP}{Nar} \\
\F{NaP}{K} &=& -\F{NaP}{Na}/1.5
\end{eqnarray}

\subsubsection{PMCA. Calcium and proton fluxes through the calcium pump operating as an electroneutral Ca:2H exchanger  [17, 18]}

\setcounter{equation}{0}
\renewcommand{\theequation}{12.\alph{equation}}

\begin{eqnarray}
\F{CaP}{Ca} &=& -\kk{CaP}{}\left(\frac{(\CCatp)^4}{(0.0002)^4 + (\CCa^{2+})^4}\right)\\
\F{CaP}{H} &=& -2\times\F{CaP}{Ca}
\end{eqnarray}

\subsubsection{Electrodiffusional fluxes of i (Na, K, Ca, Mg, H and A) through endogenous channels, FGi , Gardos channels, FGGardos, and PIEZO1 channels, Fzi, are represented with constant field kinetics [19]: }

\setcounter{equation}{12}
\renewcommand{\theequation}{\arabic{equation}}
\begin{equation}
\F{G}{i} = -P_{G}i\left(\frac{ziFEm}{RT}\right)\left(\frac{Ci – Mi\exp^{-ziFEm/RT}}{1 – exp^{-ziFEm/RT}}\right)
\end{equation}
with PGi representing the Goldmanian i-permeability in $h^{-1}$ units

The default RS value of $P_{G}Mg$ should be set equal to that of $Ca$, $P_{G}Mg = P_{G}Ca = 0.05/h$. For this preliminary investigation using RCM, there is no need to add $FzMg/PzMg$.

\subsubsection{PGKGardos is a function of $CCa^{2+}$ [20, 21] as follows:}
\begin{equation}
P_{G}K_{Gardos} = PK_{GardosMax}\left(\frac{(\CCatp)^4}{(\KCa)^4 + (\CCatp)^4}\right)
\end{equation}

\subsubsection{PGCa is a function of $CCa^{2+}$ and $MCa^{2+}$ [21, 22] as follows:}
\begin{equation}
P_{G}Ca = \left(\frac{\CCatp}{0.0002 + \CCatp}\right)\left(\frac{\MCatp}{0.8 + \MCatp}\right)
\end{equation}

\subsubsection{Low-saturation, carrier mediated flux phenomenology for electroneutral cotransporters FNaA, FKA and FHA.}

\setcounter{equation}{0}
\renewcommand{\theequation}{16.\alph{equation}}
\begin{eqnarray}
\F{Na}{A} &=& - \kk{NaA}{}(\CNa\times\CA – \MNa\times\MA) \\
\F{K}{A} &=& - \kk{KA}{}(\CK\times\CA – \MK\times\MA) \\
\F{H}{A} &=& - \kk{HA}{}(\CH\times\CA – \MH\times\MA) 
\end{eqnarray}

Note that $\kk{HA}{}$, the rate constant of the H:A cotransport phenomenology representing the operation of the Jacob-Stewart mechanism (JS) is between five and six orders of magnitude faster than that of any of the other ion transporters in the membrane (see User Guide for details and references).  

\setcounter{equation}{0}
\renewcommand{\theequation}{17.\alph{equation}}

\subsubsection{Electroneutral Na:K:2A cotransport}

\begin{eqnarray}
\F{Co}{} &=& -\kk{Co}{}((CNa\times\CK\times\CA^2) – d(MNa\times\MK\times\MA^2)) \\
d &=& \frac{\CNa\times\CK\times\CA^2}{\MNa\times\MK\times\MA^2}
\end{eqnarray}
The CX and MX values in eq 17b are those set for the RS 
\begin{eqnarray}
\F{Co}{Na} &=& \F{Co}{K} = \F{Co}{}\\
\F{Co}{A} &=& 2\F{Co}{}
\end{eqnarray}
$d$ is a wildcard factor introduced to set $\F{Co}{} = 0$ only in the RS. Its value is set by the initial Na, K and A concentrations in the RS. $d$ remains as a fixed-value parameter during dynamic state computations.    

\subsubsection{Electroneutral $M^{2+}:2H^+$ exchange fluxes of $Ca^{2+}$ and $Mg^{2+}$ mediated by the divalent cation ionophore A23187}

The divalent cation ionophore A23187 mediates an electroneutral $M^{2+}:2H^+$ exchange when incorporated into cell membranes [23]. Divalent cation ionophores became essential and extensively used tools in research on calcium and magnesium function and dysfunction in RBCs [5, 7, 24, 25] and in many other cell types. To emulate experimental protocols with the use of divalent cation ionophores it became necessary to represent their transport properties in the model as an optional exogenous transporter of the RBC membrane.  

In albumin-free RBC suspensions, the RBC/medium partition ratio of the lipophilic ionophore A23187 is 60/1, 20 to 50\% of it confined to the cell membrane [26].  The transport kinetics of the ionophore was modeled with symmetric binding (Km) and inhibitory (KI) dissociation constants for $Ca^{2+}$ and $Mg^{2+}$ on each membrane side, as follows:


\begin{eqnarray}
\nonumber A1 &=& \frac{\MCatp}{\Km{Ca}(1 + \MMgtp/(\KI{Mg} + \MCatp))} \\
\nonumber A2 &=& \frac{\CCatp}{\Km{Ca}(1 + \CMgtp/(\KI{Mg} + \CCatp))}  \\
\nonumber A3 &=& \frac{\MMgtp}{\Km{Mg}(1 + \MCatp/(\KI{Ca} + \MMgtp))}  \\
\nonumber A4 &=& \frac{\CMgtp}{\Km{Mg}(1 + \CCatp/(\KI{Ca} + \CMgtp))} 
\end{eqnarray}

Following extensive preliminary tests [27], default values of 10 mM for the four Km and KI parameter set were found to deliver excellent agreement between predicted and measured ionophore-mediated fluxes, and to ensure adequate compliance with the measured equilibrium distribution of the transported ions when ionophore-mediated net fluxes approach zero [23]: 
\[\CCatp/\MCatp \approx \CMgtp/\MMgtp \approx (\CH^+/\MH^+)^2.\]

Combining the $Ca^{2+}$, $Mg^{2+}$ and $H^+$ driving gradients we obtain:
\begin{eqnarray}
\nonumber B1&=& A1(\CH)^2 - A2(\MH)^2 \\
\nonumber B2&=& A3(\CH)^2 - A4(\MH)^2
\end{eqnarray}

The ionophore-mediated fluxes of $Ca^{2+}$, $Mg^{2+}$ and $H^+$, $\F{A23}{Ca}$, $\F{A23}{Mg}$ and $\F{A23}{H}$, respectively, can now be computed from: 

\setcounter{equation}{0}
\renewcommand{\theequation}{A23-\arabic{equation}}

\begin{eqnarray}
\F{A23}{Ca} &=& P_{A23}B1 \\
\F{A23}{Mg} &=& P_{A23}B2 \\
\F{A23}{H} &=& -2(\F{A23}{Ca} + \F{A23}{Mg})
\end{eqnarray}

Where $P_{A23}$ is the ionophore-mediated permeability. $P_{A23}$ is a power function of the RBC ionophore concentration, $P_{A23} = 0.22\times [I]^{1.45}$, when $P_{A23}$ is expressed in units of $10^{-6}$ cm/s, and [I] in $\mu$mol/Loc [26, 28, 29]. Within the units-set in the model, numerical values of $P_{A23}$ in the range $10^{17}$ to $2\times10^{18}$ offered a perfectly adequate minimalist emulation of the effects of different ionophore concentrations on the fluxes and distributions of $Ca^{2+}$, $Mg^{2+}$ and $H^{+}$ ions in RBCs in a large variety of experimental conditions [5, 27, 30-33].    

\subsubsection{Equation sequence for the computations of dynamic states.}
Following perturbations, sustained charge conservation and electroneutrality is implemented by:

\setcounter{equation}{0}
\renewcommand{\theequation}{18\alph{equation}}

\begin{equation}
\sum I_j = 0 
\end{equation}
where $I_j$ represents the current carried by each of the j-membrane transporters. $\sum I_j$ is therefore the fist equation that has to be solved at the start of each iteration in the computational sequence of dynamic states. Capacitative currents ($Ic = C(dV/dt))$ are ignored because their magnitude and time-course decay are orders of magnitude smaller than those of the homeostatic relevant currents.  The relation between currents and fluxes, $F_j$, is given by 

\begin{equation}
I_j = F z_j F_j
\end{equation}

With the electrogenic flux components in the model $(z_j\neq 0), \sum I_j = 0$ renders:

\begin{equation}
\sum I_j = \F{NaP}{Na} + \F{NaP}{K} + \F{G}{Na} + \F{G}{K} + \F{G}{K_{Gardos}} + \F{G}{A} + \F{G}{Ca} + \F{G}{Mg} + \F{G}{H} + \F{z}{Na} + \F{z}{K} + \F{z}{A} + \F{z}{Ca} = 0
\end{equation}
$I_j$ is a complex function of temperature, membrane potential, $Em$, and of the concentration of all transported and modulating substrates.  With all parameters, kinetics and substrate concentrations known $\sum I_j = 0$ becomes an implicit equation in $Em$, the single unknown left, solved in each iteration with the Newton-Raphson cord approximation routine.      

With $Em$, the new $z_jF_j$ values for each of the electrodiffusional terms in eq 18c can be computed.  We can now add up the absolute values of the new computed fluxes to the values of the electroneutral fluxes in the previous iteration $\sum |F_j|$ to assign a new $\Delta t$ duration to each iteration interval, as follows:  

\setcounter{equation}{18}
\renewcommand{\theequation}{\arabic{equation}}
\begin{equation}
\Delta t = \frac{a}{b + \sum|F_j|}
\end{equation}

The value of $a$, under user control, optimises $\Delta t$ scales for different simulations (“frequencyfactor” in the RCM); $b$ is a small zero-avoidance parameter in the denominator. The advantage of this strategy over using regular iteration intervals is that by setting a constant value for the cycles per outcome (“cyclesperprint(epochs)” in the RCM) the density of data output points automatically adjusts to the overall rate of change in the system, emulating the way good experimental practice seeks to sample for data at the bench, thus optimizing comparisons between predicted and experimental results.    

With the new $F_i^t$ and $\Delta t$ the new $Qi^t$ may be computed using the values of $FNa^t$, $FK^t$, $FA^t$, $FH^t$, $FCa^t$ and $\F{A23}{Mg}^t$ from equations (10a-f) as follows:

\setcounter{equation}{0}
\renewcommand{\theequation}{20\alph{equation}}

\begin{eqnarray}
\Delta QNa &=& FNa\times\Delta t\\
\Delta QK &=& FK\times\Delta t \\
\Delta QA &=& FA\times\Delta t \\
\Delta H &=& FH\times\Delta t \\
\Delta QCa &=& FCa\times\Delta t \\
\Delta QMg &=& (\F{G}{Mg} + \F{A23}{Mg})\times\Delta t \\
QNa^t &=& QNa^{(t-\Delta t)} + \Delta QNa \\
QK^t &=& QK^{(t-\Delta t)} + \Delta QK  \\
QA^t &=& QA^{(t-\Delta t)} + \Delta QA  \\
QCa^t &=& QCa^{(t-\Delta t)} + \Delta QCa  \\
QMg^t &=& QMg^{(t-\Delta t)} + \Delta QMg
\end{eqnarray}

$\Delta H$ is a special case because $\Delta H$ adds to the only titratable proton buffer $nHb\times QHb$, so that:
\setcounter{equation}{0}
\renewcommand{\theequation}{21\alph{equation}}
\begin{eqnarray}
nHb^t\times QHb &=& nHb^{(t-\Delta t)}\times QHb + \Delta H \\
nHb^t &=& nHb^{(t-\Delta t)}  + \frac{\Delta H}{QHb}
\end{eqnarray}

From which we can now compute the new cell pHi from eq 4 by solving for $pH^t$:

\begin{equation}
pH^t = \frac{nHb^t}{a} + pI
\end{equation}
The new intracellular $H^+$ concentration in molar units is:
\begin{equation}
CH^t = 10^{-pH^t}
\end{equation}

With the new $Qi^t$, we need the new cell water volume, $Vw^t$ in order to compute the new cell concentrations, $Ci^t = Qi^t/Vw^t$.  The water flux across the RBC membrane, $Fw$, is driven by the osmotic gradient across the RBC membrane (eqs 5 and 6): 
\setcounter{equation}{0}
\renewcommand{\theequation}{22\alph{equation}}

\begin{equation}
Fw^t = Pw(\COs^t – \MOs^{(t-\Delta t)}) 
\end{equation}
$\COs^t$ can be computed from the altered osmotic load resulting from the $\Delta Qi$ changes during $\Delta t$ operating on the cell volume at the start of the each iteration interval: 

\begin{equation}
COs^t = \frac{QNa^t + QK^t + QA^t + QCa^t + QMg^t}{Vw^{(t-\Delta t)}}  + (f_{Hb}\times\CHb + \CX )^{(t-\Delta t)}
\end{equation}


\setcounter{equation}{0}
\renewcommand{\theequation}{23\alph{equation}}

The new cell water volume, $Vw^t$, and volume-associated variables, $RCV^t$, $MCHC^t$, $Density^t$ and $Hct^t$, can now be computed from: 
\begin{eqnarray}
\Delta Vw^t &=& Fw^t\times\Delta t \\
Vw^t &=& Vw^{(t-\Delta t)} + \Delta Vw \\
RCV^t &=& 1-Vw^{(t=0)} + Vw^t  \\
MCHC^t &=& MCHC^{(t=0)}/RCV  \\
Density^t &=& ((MCHC^{(t=0)}/100) + Vw^t)/RCV  \\
Hct^t &=& Htc^{(t=0)}\times RCV  
\end{eqnarray}

With $Vw^t$ we proceed to compute next the new intracellular concentrations of Na, K, A, H, Ca, Hb, and X:

\setcounter{equation}{0}
\renewcommand{\theequation}{24\alph{equation}}

\begin{eqnarray}
\CNa^t &=& QNa^t/Vw^t \\
\CK^t &=& QK^t/Vw^t \\
\CA^t &=& QA^t/Vw^t  \\
\CCa^t &=& QCa^t/Vw^t  \\
\CMg^t &=& QMg^t/Vw^t  \\
\CHb^t &=& QHb/Vw^t \\
(\CX^{-})^t &=& QX^{-} /Vw^t  
\end{eqnarray}

The new osmotic coefficient of Hb, $f_{Hb}^t$, can now be calculated from eq 7 and the new $\CHb^t$:

\setcounter{equation}{24}
\renewcommand{\theequation}{\arabic{equation}}

\begin{equation}
f_{Hb}^t = 1 + b\times\CHb^t + c\times (CHb^t)^2
\end{equation}

\subsubsection{Computation of the medium concentrations at time = t.}
Medium concentration changes arise from independent solute and water transfers between cells and medium under mass conservation.  At constant suspension volume, water transfers between cells and medium generate self-compensating changes in cell and medium volume fractions, CVF and (1-CVF), respectively, according to:

\setcounter{equation}{0}
\renewcommand{\theequation}{26\alph{equation}}

\begin{equation}
\Delta CVF + \Delta (1-CVF) = 0
\end{equation}
By mass conservation, the $Qi$ changes during $\Delta t$, $\Delta Qi$, are transferred to the medium, $\Delta Qim$, so that:
\begin{equation}
\Delta Qim + \Delta Qi = 0  
\end{equation}

$\Delta Qim$ can be expressed in terms of $Mi$ changes during $\Delta t$ as follows:

\begin{equation}
\Delta Qim = Mi^t(1-CVF^t) – Mi^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) 
\end{equation}

Replacing $\Delta Qim$ by $-\Delta Qi$ (eq 26b) in equation 26c and solving for $Mi^t$, we obtain:

\begin{equation}
Mi^t = \frac{Mi^{(t-\Delta t)}(1 - CVF^{(t-\Delta t)}) - \Delta Qi}{1 - CVF^t}
\end{equation}
With eq 26d we can now compute the new medium concentrations at time = t for transported solutes, eqs 27a-f, and for impermeant solutes ($\Delta Qi = 0$) whose concentration changes only because of water shifts, eqs 27g-j:

\setcounter{equation}{0}
\renewcommand{\theequation}{27\alph{equation}}

\begin{eqnarray}
\MNa^t = \frac{\MNa^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) - \Delta QNa}{1 – CVF^t }\\
\MK^t = \frac{\MK^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) - \Delta QK}{1 – CVF^t }\\
\MA^t = \frac{\MA^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) - \Delta QA}{1 – CVF^t }\\
\MCa^t = \frac{\MCa^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) - \Delta QCa}{1 – CVF^t }\\
\MMg^t = \frac{\MMg^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) - \Delta QMg}{1 – CVF^t }\\
\MBH^t = \frac{\MBH^{(t-\Delta t)}(1-CVF^{(t-\Delta t)}) - \Delta QH}{1 – CVF^t }\\
\MB^t = \frac{\MB^{(t-\Delta t)}(1-CVF^{(t-\Delta t)})}{1 – CVF^t) }\\
\MGluco^t = \frac{\MGluco^{(t-\Delta t)}(1-CVF^{(t-\Delta t)})}{1 – CVF^t }\\
\MGluca^t = \frac{\MGluca^{(t-\Delta t)}(1-CVF^{(t-\Delta t)})}{1 – CVF^t }\\
\MSuc^t = \frac{\MSuc^{(t-\Delta t)}(1-CVF^{(t-\Delta t)})}{1 – CVF^t} 
\end{eqnarray}

With $MBH^t$ and $MB^t$ from eqs 27e-f we can now compute the new medium proton concentration $MH^t$ by solving eq 2 for $MH$, so that:

\setcounter{equation}{0}
\renewcommand{\theequation}{28\alph{equation}}

\begin{equation}
\MH^t = KB\frac{\MBH^t}{\MB^t – \MBH^t}
\end{equation}

With $MH^t$, we can now compute $pHm^t$, and also the proton and anion concentration ratios across the membrane, $rH^t$ and $rA^t$, respectively, critical parameters for driving the proton transport dynamics in the model ([34]; User Guide).

\begin{eqnarray}
pHm^t&=& -\log\MH^t\\
rH^t &=&\frac{\MH^t}{\CH^t} \\
rA^t &=& \frac{\CA^t}{\MA^t} 
\end{eqnarray}

This completes the list of sequential computations within each iteration cycle of the core red cell model.    

here is a substantial body of additional information implemented in the model, marginal to the core of the gov-
erning equations, information revised, filtered, and, when experimentally tested and confirmed, incorporated in the
model as part of the continuous process of improving the quantitative accuracy of model predictions. The effects of
temperature on transport, in addition to those incorporated within the kinetic description (constant field equation,
ziFEm/RT, for instance) are represented by factors using the traditional Q10 phenomenology, with the option to alter
the default values of 4 and 2 for active and passive transport, respectively. Most ion effects render themselves to
be represented by factors modifying rate constants or dissociation constants in flux equations (e.g Na/K pump, eq
11), without altering the actual overall kinetics of the transport pathways. Because of their particular relevance to
the circulatory behaviour of RBCs we only listed here explicitly the modulating effects of Ca2+ on PGGardos and on
PGCa, equations 14 and 15, respectively. The complete model code is available with open access in the repository
(https://github.com/sdrogers/redcellmodeljava)
% The complete model code is available with open access in the repository (https://github.com/sdrogers/redcellmodeljava).   


\section{References}
\begin{enumerate}
\item Rogers S, Lew VL. Up-down biphasic volume response of human red blood cells to PIEZO1 activation during capillary transits. 2020.
\item Rogers S, Lew VL. PIEZO1 and the mechanism of the long circulatory longevity of human red blood cells. 2020.
\item Whittam R. Transport and diffusion in red blood cells. London: Edward Arnold; 1964 1964.
\item Cass A, Dalmark M. Equilibrium dialysis of ions in nystatin-treated cells. Nature New Biol. 1973;244:47-9.
\item Ferreira HG, Lew VL. Use of ionophore A23187 to measure cytoplasmic Ca buffering and activation of the Ca pump by internal Ca. Nature. 1976;259:47-9.
\item Tiffert T, Lew VL. Cytoplasmic calcium buffers in intact human red cells. J Physiol. 1997;500 ( Pt 1):139-54. PubMed PMID: 9097939; PubMed Central PMCID: PMCPMC1159365.
\item Flatman P, Lew VL. Use of ionophore A23187 to measure and to control free and bound cytoplasmic Mg in intact red cells. Nature. 1977;267(5609):360-2. PubMed PMID: 325421.
\item Raftos JE, Lew VL, Flatman PW. Refinement and evaluation of a model of $Mg^{2+}$ buffering in human red cells. Eur J Biochem. 1999;263(3):635-45.
\item Etzion Z, Tiffert T, Bookchin RM, Lew VL. Effects of deoxygenation on active and passive $Ca^{2+}$ transport and on the cytoplasmic $Ca^{2+}$ levels of sickle cell anemia red cells. Journal of Clinical Investigation. 1993;92:2489-98.
\item Tiffert T, Etzion Z, Bookchin RM, Lew VL. Effects of deoxygenation on active and passive $Ca^{2+}$ transport and cytoplasmic $Ca^{2+}$ buffering in normal human red cells. J Physiol. 1993;464:529-44.
\item Ortiz OE, Lew VL, Bookchin RM. Deoxygenation permeabilizes sickle cell anaemia red cells to magnesium and reverses its gradient in the dense cells. J Physiol. 1990;427:211-26.
\item Freeman CJ, Bookchin RM, Ortiz OE, Lew VL. K-permeabilized human red cells lose an alkaline, hypertonic fluid containing excess K over diffusible anions. J Membrane Biol. 1987;96:235-41.
\item Swietach P, Tiffert T, Mauritz JM, Seear R, Esposito A, Kaminski CF, et al. Hydrogen ion dynamics in human red blood cells. J Physiol. 2010;588(Pt 24):4995-5014.
\item Waldecker M, Dasanna AK, Lansche C, Linke M, Srismith S, Cyrklaff M, et al. Differential time-dependent volumetric and surface area changes and delayed induction of new permeation pathways in P. falciparum-infected hemoglobinopathic erythrocytes. Cell Microbiol. 2017;19(2). doi: 10.1111/cmi.12650. PubMed PMID: 27450804; PubMed Central PMCID: PMCPMC5298026.
\item Garay RP, Garrahan PJ. The interaction of sodium and potassium with the sodium pump in red cells. J Physiol (Lond). 1973;231(2):297-325.
\item Garrahan PJ, Garay RP. A kinetic study of the Na pump in red cells: its relevance to the mechanism of active transport. Ann N Y Acad Sci. 1974;242(0):445-58.
\item Niggli V, Sigel E, Carafoli E. The purified $Ca^{2+}$ pump of human erythrocyte membranes catalyzes an electroneutral $Ca^{2+}$-H+ exchange in reconstituted liposomal systems. J Biol Chem. 1982;257(5):2350-6.
\item Thomas RC. The plasma membrane calcium ATPase (PMCA) of neurones is electroneutral and exchanges 2 H+ for each $Ca^{2+}$ or $Ba^{2+}$ ion extruded. J Physiol. 2009;587(2):315-27. doi: 10.1113/jphysiol.2008.162453. PubMed PMID: 19064619; PubMed Central PMCID: PMCPMC2670047.
\item Goldman DE. Potential, Impedance, and Rectification in Membranes. J Gen Physiol. 1943;27(1):37-60. doi: 10.1085/jgp.27.1.37. PubMed PMID: 19873371; PubMed Central PMCID: PMCPMC2142582.
\item Simons TJB. Calcium-dependent potassium exchange in human red cell ghosts. J Physiol. 1976;256:227-44.
\item Lew VL, Ferreira HG. Calcium transport and the properties of a calcium-activated potassium channel in red cell membranes. In: Kleinzeller A, Bronner F, editors. Current Topics in Membranes and Transport, Vol 10: Academic Press, NY; 1978. p. 217-77.
\item Tiffert T, Garcia-Sancho J, Lew VL. Irreversible ATP depletion caused by low concentrations of formaldehyde and of calcium-chelator esters in intact human red cells. Biochim Biophys Acta. 1984;773(1):143-56. PubMed PMID: 6428450.
\item Pressman BC. Biological applications of ionophores. Annual Reviews of Biochemistry. 1976;45:501-30.
\item Lew VL, Hockaday A, Sepulveda MI, Somlyo AP, Somlyo AV, Ortiz OE, et al. Compartmentalization of sickle-cell calcium in endocytic inside-out vesicles. Nature. 1985;315(6020):586-9. PubMed PMID: 4010773.
\item Lew VL, Muallem S, Seymour CA. Properties of the $Ca^{2+}$-activated $K^+$ channel in one-step inside-out vesicles from human red cell membranes. Nature. 1982;296:742-4.
\item Simonsen LO, Lew VL. The correlation between ionophore A23187 content and calcium permeability of ATP-depleted human red blood cells. In: Lassen UV, Ussing HH, Wieth JO, editors. Membrane Transport in Erythrocytes. Copenhagen: Munksgaard; 1980. p. 208-12.
\item Raftos JE, Lew VL. Effect of intracellular magnesium on calcium extrusion by the plasma membrane calcium pump of intact human red cells. J Physiol. 1995;489:63-72.
\item Lew VL, Simonsen LO. Ionophore A23187-induced calcium permeability of intact human red blood cells. J Physiol. 1980;308:60P.
\item Simonsen LO, Gomme J, Lew VL. Uniform ionophore A23187 distribution and cytoplasmic calcium buffering in intact human red cells. Biochim Biophys Acta. 1982;692:431-40.
\item García-Sancho J, Lew VL. Heterogeneous calcium and adenosine triphosphate distribution in calcium-permeabilized human red cells. J Physiol. 1988;407:523-39.
\item García-Sancho J, Lew VL. Detection and separation of human red cells with different calcium contents following uniform calcium permeabilization. J Physiol. 1988;407:505-22.
\item Tiffert T, Spivak JL, Lew VL. Magnitude of calcium influx required to induce dehydration of normal human red cells. Biochim Biophys Acta. 1988;943:157-65.
\item Flatman PW, Lew VL. The magnesium-dependence of sodium:potassium and sodium:sodium exchange mediated by the sodium pump in intact human red cells [proceedings]. J Physiol. 1979;287:33P-4P. PubMed PMID: 430415.
\item Lew VL, Bookchin RM. Volume, pH, and ion-content regulation in human red cells: analysis of transient behavior with an integrated model. J Membr Biol. 1986;92(1):57-74. PubMed PMID: 3746891.
\item Flatman PW, Lew VL. The magnesium dependence of sodium-pump-mediated sodium-potassium and sodium-sodium exchange in intact human red cells. J Physiol. 1981;315:421-46. PubMed PMID: 6796677; PubMed Central PMCID: PMC1249391.
\end{enumerate}

\end{document}
